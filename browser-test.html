<!DOCTYPE html>
<html>
<head>
    <title>Тест API координат</title>
</head>
<body>
    <h1>Тест API endpoint для обновления координат</h1>
    <button onclick="testCoordinatesAPI()">Тестировать PATCH /coordinates</button>
    <button onclick="testHealthAPI()">Тестировать Health Check</button>
    <button onclick="testPlayersAPI()">Тестировать GET /players</button>
    
    <div id="results" style="margin-top: 20px; font-family: monospace; white-space: pre-wrap;"></div>

    <script>
        function log(message) {
            const results = document.getElementById('results');
            results.textContent += new Date().toLocaleTimeString() + ': ' + message + '\n';
        }

        async function testHealthAPI() {
            log('=== ТЕСТ HEALTH CHECK ===');
            try {
                const response = await fetch('/api/health');
                log(`Health response status: ${response.status}`);
                const data = await response.json();
                log(`Health data: ${JSON.stringify(data, null, 2)}`);
            } catch (error) {
                log(`Health error: ${error.message}`);
            }
        }

        async function testPlayersAPI() {
            log('=== ТЕСТ GET PLAYERS ===');
            try {
                const response = await fetch('/api/players');
                log(`Players response status: ${response.status}`);
                const data = await response.json();
                log(`Players count: ${data.players ? data.players.length : 'undefined'}`);
                if (data.players && data.players.length > 0) {
                    log(`First player: ${JSON.stringify(data.players[0], null, 2)}`);
                }
            } catch (error) {
                log(`Players error: ${error.message}`);
            }
        }

        async function testCoordinatesAPI() {
            log('=== ТЕСТ COORDINATES API ===');
            
            // Сначала получаем список игроков
            try {
                const playersResponse = await fetch('/api/players');
                const playersData = await playersResponse.json();
                
                if (!playersData.players || playersData.players.length === 0) {
                    log('❌ Нет игроков в базе данных');
                    return;
                }
                
                const testPlayer = playersData.players[0];
                log(`Тестируем с игроком: ID=${testPlayer.id}, Name=${testPlayer.name}`);
                
                // Тестируем обновление координат
                const testCoords = { x: Math.random() * 500, y: Math.random() * 300 };
                log(`Отправляем координаты: ${JSON.stringify(testCoords)}`);
                
                const coordsResponse = await fetch(`/api/players/${testPlayer.id}/coordinates`, {
                    method: 'PATCH',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(testCoords)
                });
                
                log(`Coordinates response status: ${coordsResponse.status}`);
                
                if (coordsResponse.ok) {
                    const coordsData = await coordsResponse.json();
                    log(`✅ Успех: ${JSON.stringify(coordsData, null, 2)}`);
                } else {
                    const errorText = await coordsResponse.text();
                    log(`❌ Ошибка ${coordsResponse.status}: ${errorText}`);
                }
                
            } catch (error) {
                log(`❌ Критическая ошибка: ${error.message}`);
            }
        }

        // Автоматически запускаем health check при загрузке
        window.onload = function() {
            testHealthAPI();
        };
    </script>
</body>
</html>
