<!DOCTYPE html>
<html>
<head>
    <title>WebSocket Test –¥–ª—è Malabar</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .status { padding: 10px; margin: 10px 0; border-radius: 5px; }
        .connected { background-color: #d4edda; border: 1px solid #c3e6cb; }
        .disconnected { background-color: #f8d7da; border: 1px solid #f5c6cb; }
        .connecting { background-color: #fff3cd; border: 1px solid #ffeaa7; }
        button { padding: 10px 20px; margin: 5px; cursor: pointer; }
        #log { background: #f8f9fa; padding: 10px; height: 300px; overflow-y: scroll; border: 1px solid #dee2e6; }
    </style>
</head>
<body>
    <h1>WebSocket Test –¥–ª—è Malabar Event Site</h1>
    
    <div id="status" class="status disconnected">
        –°—Ç–∞—Ç—É—Å: –ù–µ –ø–æ–¥–∫–ª—é—á–µ–Ω
    </div>
    
    <button onclick="connectWS()">–ü–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è</button>
    <button onclick="disconnectWS()">–û—Ç–∫–ª—é—á–∏—Ç—å—Å—è</button>
    <button onclick="clearLog()">–û—á–∏—Å—Ç–∏—Ç—å –ª–æ–≥</button>
    
    <h3>–¢–µ—Å—Ç–∏—Ä—É–µ–º—ã–µ URL:</h3>
    <ul>
        <li>Production: ws://46.173.17.229:3001/ws</li>
        <li>Local: ws://localhost:3001/ws</li>
    </ul>
    
    <h3>–õ–æ–≥ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è:</h3>
    <div id="log"></div>
    
    <script>
        let ws = null;
        const statusDiv = document.getElementById('status');
        const logDiv = document.getElementById('log');
        
        function log(message) {
            const timestamp = new Date().toLocaleTimeString();
            logDiv.innerHTML += `[${timestamp}] ${message}<br>`;
            logDiv.scrollTop = logDiv.scrollHeight;
            console.log(message);
        }
        
        function updateStatus(status, className) {
            statusDiv.textContent = `–°—Ç–∞—Ç—É—Å: ${status}`;
            statusDiv.className = `status ${className}`;
        }
        
        function connectWS() {
            if (ws && ws.readyState === WebSocket.OPEN) {
                log('WebSocket —É–∂–µ –ø–æ–¥–∫–ª—é—á–µ–Ω');
                return;
            }
            
            const wsUrl = 'ws://46.173.17.229:3001/ws';
            log(`–ü–æ–ø—ã—Ç–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫: ${wsUrl}`);
            updateStatus('–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ...', 'connecting');
            
            try {
                ws = new WebSocket(wsUrl);
                
                ws.onopen = function(event) {
                    log('‚úÖ WebSocket –ø–æ–¥–∫–ª—é—á–µ–Ω —É—Å–ø–µ—à–Ω–æ!');
                    updateStatus('–ü–æ–¥–∫–ª—é—á–µ–Ω', 'connected');
                };
                
                ws.onmessage = function(event) {
                    log(`üì® –ü–æ–ª—É—á–µ–Ω–æ —Å–æ–æ–±—â–µ–Ω–∏–µ: ${event.data}`);
                };
                
                ws.onclose = function(event) {
                    log(`üîå WebSocket –æ—Ç–∫–ª—é—á–µ–Ω. –ö–æ–¥: ${event.code}, –ü—Ä–∏—á–∏–Ω–∞: ${event.reason || '–ù–µ —É–∫–∞–∑–∞–Ω–∞'}`);
                    updateStatus('–û—Ç–∫–ª—é—á–µ–Ω', 'disconnected');
                    
                    // –†–∞—Å—à–∏—Ñ—Ä–æ–≤–∫–∞ –∫–æ–¥–æ–≤ –∑–∞–∫—Ä—ã—Ç–∏—è
                    const closeCodes = {
                        1000: '–ù–æ—Ä–º–∞–ª—å–Ω–æ–µ –∑–∞–∫—Ä—ã—Ç–∏–µ',
                        1001: '–°–µ—Ä–≤–µ—Ä –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω',
                        1002: '–û—à–∏–±–∫–∞ –ø—Ä–æ—Ç–æ–∫–æ–ª–∞',
                        1003: '–ù–µ–ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–π —Ç–∏–ø –¥–∞–Ω–Ω—ã—Ö',
                        1006: '–ê–Ω–æ–º–∞–ª—å–Ω–æ–µ –∑–∞–∫—Ä—ã—Ç–∏–µ',
                        1011: '–û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞',
                        1015: '–û—à–∏–±–∫–∞ TLS'
                    };
                    
                    if (closeCodes[event.code]) {
                        log(`–†–∞—Å—à–∏—Ñ—Ä–æ–≤–∫–∞: ${closeCodes[event.code]}`);
                    }
                };
                
                ws.onerror = function(error) {
                    log(`‚ùå –û—à–∏–±–∫–∞ WebSocket: ${error.type}`);
                    updateStatus('–û—à–∏–±–∫–∞', 'disconnected');
                };
                
            } catch (error) {
                log(`‚ùå –ò—Å–∫–ª—é—á–µ–Ω–∏–µ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ WebSocket: ${error.message}`);
                updateStatus('–û—à–∏–±–∫–∞', 'disconnected');
            }
        }
        
        function disconnectWS() {
            if (ws) {
                ws.close(1000, '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–∫–ª—é—á–∏–ª—Å—è');
                ws = null;
            }
        }
        
        function clearLog() {
            logDiv.innerHTML = '';
        }
        
        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ç–µ—Å—Ç –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        document.addEventListener('DOMContentLoaded', function() {
            log('–°—Ç—Ä–∞–Ω–∏—Ü–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞. –ù–∞–∂–º–∏—Ç–µ "–ü–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è" –¥–ª—è —Ç–µ—Å—Ç–∞.');
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∏ WebSocket
            if (typeof WebSocket !== 'undefined') {
                log('‚úÖ WebSocket –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è –±—Ä–∞—É–∑–µ—Ä–æ–º');
            } else {
                log('‚ùå WebSocket –ù–ï –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è –±—Ä–∞—É–∑–µ—Ä–æ–º');
            }
        });
    </script>
</body>
</html>
