# üîß –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï PM2 ERRORED –°–¢–ê–¢–£–°–ê

## üìã –ü—Ä–æ–±–ª–µ–º–∞
PM2 –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å—Ç–∞—Ç—É—Å "errored" –¥–ª—è malabar-server, —á—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç —á—Ç–æ —Å–µ—Ä–≤–µ—Ä –ø–∞–¥–∞–µ—Ç –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ.

## ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### 1. **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ –∏–º—è –ø—Ä–æ—Ü–µ—Å—Å–∞ –≤ ecosystem.config.js**
- –ò–∑–º–µ–Ω–µ–Ω–æ —Å `malabar-backend` –Ω–∞ `malabar-server`
- –¢–µ–ø–µ—Ä—å –∫–æ–º–∞–Ω–¥—ã `pm2 status malabar-server` –±—É–¥—É—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

### 2. **–î–æ–±–∞–≤–ª–µ–Ω–∞ –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∞—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å**
- –î–æ–±–∞–≤–ª–µ–Ω `cookie-parser` –≤ `server/package.json`
- –°–µ—Ä–≤–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª —ç—Ç—É –±–∏–±–ª–∏–æ—Ç–µ–∫—É, –Ω–æ –æ–Ω–∞ –Ω–µ –±—ã–ª–∞ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—è—Ö

### 3. **–£–ª—É—á—à–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö**
- –î–æ–±–∞–≤–ª–µ–Ω–∞ –¥–µ—Ç–∞–ª—å–Ω–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –æ—à–∏–±–æ–∫ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –ë–î
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –¥–ª—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
- Graceful shutdown –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö –ë–î

### 4. **–£–ª—É—á—à–µ–Ω –∑–∞–ø—É—Å–∫ —Å–µ—Ä–≤–µ—Ä–∞**
- –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ —É—Å–ø–µ—à–Ω–æ–≥–æ –∑–∞–ø—É—Å–∫–∞
- –î–µ—Ç–∞–ª—å–Ω—ã–µ –ª–æ–≥–∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è —Å–µ—Ä–≤–µ—Ä–∞
- –ü—Ä–æ–≤–µ—Ä–∫–∞ —á—Ç–æ —Å–µ—Ä–≤–µ—Ä –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ —Å–ª—É—à–∞–µ—Ç –ø–æ—Ä—Ç

## üöÄ –ö–æ–º–∞–Ω–¥—ã –¥–ª—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:
```bash
# –ó–∞–ø—É—Å—Ç–∏—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Å–∫—Ä–∏–ø—Ç –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è
chmod +x fix-and-restart-server.sh
./fix-and-restart-server.sh
```

### –†—É—á–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã:

#### 1. –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∏ –æ—á–∏—â–∞–µ–º PM2:
```bash
pm2 stop all
pm2 delete all
```

#### 2. –°–æ–∑–¥–∞–µ–º –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏:
```bash
node create-logs-dir.js
```

#### 3. –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:
```bash
cd server
npm install
cd ..
```

#### 4. –ó–∞–ø—É—Å–∫–∞–µ–º —Å–µ—Ä–≤–µ—Ä:
```bash
pm2 start ecosystem.config.js --only malabar-server
```

#### 5. –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç–∞—Ç—É—Å:
```bash
pm2 status
pm2 logs malabar-server
```

## üîç –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤:
```bash
# –õ–æ–≥–∏ PM2
pm2 logs malabar-server --lines 50

# –û—à–∏–±–∫–∏ PM2
pm2 logs malabar-server --err --lines 30

# –ü–æ–¥—Ä–æ–±–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø—Ä–æ—Ü–µ—Å—Å–µ
pm2 describe malabar-server
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ API:
```bash
# Health check
curl http://localhost:3001/api/health

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏–≥—Ä–æ–∫–æ–≤
curl http://localhost:3001/api/players
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Ä—Ç–∞:
```bash
# –ß—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –ø–æ—Ä—Ç 3001
lsof -i :3001

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–µ—Ç–µ–≤—ã—Ö —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π
netstat -tulnp | grep 3001
```

## üõ†Ô∏è –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã –æ—à–∏–±–æ–∫

1. **–û—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏**
   - ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û: –î–æ–±–∞–≤–ª–µ–Ω cookie-parser

2. **–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –ø—É—Ç–∏ –∫ —Ñ–∞–π–ª–∞–º**
   - ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û: –£–ª—É—á—à–µ–Ω—ã –ø—É—Ç–∏ –∫ –ë–î

3. **–ü—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ —Ñ–∞–π–ª–∞–º**
   - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ: `ls -la server/`
   - –ò—Å–ø—Ä–∞–≤–∏—Ç—å: `chmod 644 server/server.js`

4. **–ó–∞–Ω—è—Ç—ã–π –ø–æ—Ä—Ç 3001**
   - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ: `lsof -i :3001`
   - –£–±–∏–π—Ç–µ –ø—Ä–æ—Ü–µ—Å—Å: `kill -9 <PID>`

5. **–ù–µ–¥–æ—Å—Ç–∞—Ç–æ–∫ –ø–∞–º—è—Ç–∏**
   - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ: `free -h`
   - –£–≤–µ–ª–∏—á—å—Ç–µ swap –µ—Å–ª–∏ –Ω—É–∂–Ω–æ

6. **–ü—Ä–æ–±–ª–µ–º—ã —Å –ø—Ä–∞–≤–∞–º–∏ SQLite**
   - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∞ –Ω–∞ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é server/
   - –°–æ–∑–¥–∞–π—Ç–µ –ë–î –≤—Ä—É—á–Ω—É—é –µ—Å–ª–∏ –Ω—É–∂–Ω–æ

## üìä –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç

–ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π –≤—ã –¥–æ–ª–∂–Ω—ã —É–≤–∏–¥–µ—Ç—å:

```bash
pm2 status
# malabar-server  ‚îÇ 0    ‚îÇ fork ‚îÇ 12345 ‚îÇ online ‚îÇ 0       ‚îÇ 0s     ‚îÇ 0%      ‚îÇ 45.2mb ‚îÇ
```

```bash
curl http://localhost:3001/api/health
# {"status":"OK","timestamp":"2025-09-16T..."}
```

## üîß –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã

### –ü–æ–ª–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞ –∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫:
```bash
pm2 kill
pm2 start ecosystem.config.js
```

### –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏:
```bash
pm2 monit
```

### –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ PM2:
```bash
pm2 save
pm2 startup
```

---

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø—Ä–∏–º–µ–Ω–µ–Ω—ã
**–î–∞—Ç–∞:** 16 —Å–µ–Ω—Ç—è–±—Ä—è 2025
**–°–ª–µ–¥—É—é—â–∏–π —à–∞–≥:** –ó–∞–ø—É—Å—Ç–∏—Ç—å `fix-and-restart-server.sh`
