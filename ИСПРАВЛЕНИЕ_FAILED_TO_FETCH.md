# üîß –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï –û–®–ò–ë–ö–ò "Failed to fetch"

## üìã –û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã

–û—à–∏–±–∫–∞ `TypeError: Failed to fetch` –≤–æ–∑–Ω–∏–∫–∞–ª–∞ –≤ `services/apiService.js` –ø—Ä–∏ –ø–æ–ø—ã—Ç–∫–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ API —Å–µ—Ä–≤–µ—Ä—É.

## ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### 1. **–£–ª—É—á—à–µ–Ω–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è API** (`config/api.js`)
- ‚ú® –î–æ–±–∞–≤–ª–µ–Ω–∞ –¥–µ—Ç–∞–ª—å–Ω–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è URL
- üîß –£–ª—É—á—à–µ–Ω–∞ –ª–æ–≥–∏–∫–∞ –¥–ª—è VPS –æ–∫—Ä—É–∂–µ–Ω–∏—è
- üõ°Ô∏è –î–æ–±–∞–≤–ª–µ–Ω –Ω–∞–¥–µ–∂–Ω—ã–π fallback –Ω–∞ VPS IP
- üìù –î–æ–±–∞–≤–ª–µ–Ω—ã –ø–æ–¥—Ä–æ–±–Ω—ã–µ –ª–æ–≥–∏ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏

### 2. **–†–∞—Å—à–∏—Ä–µ–Ω—ã CORS –Ω–∞—Å—Ç—Ä–æ–π–∫–∏** (`server/server.js`)
- üåê –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∞ 127.0.0.1
- üîí –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∞ HTTPS (–Ω–∞ –±—É–¥—É—â–µ–µ)
- üõ†Ô∏è –£–ª—É—á—à–µ–Ω–∞ —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å legacy –±—Ä–∞—É–∑–µ—Ä–∞–º–∏

### 3. **–£–ª—É—á—à–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫** (`services/apiService.js`)
- ‚è±Ô∏è –î–æ–±–∞–≤–ª–µ–Ω —Ç–∞–π–º–∞—É—Ç 15 —Å–µ–∫—É–Ω–¥
- üîç –î–µ—Ç–∞–ª—å–Ω–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ —Å–µ—Ç–µ–≤—ã—Ö –æ—à–∏–±–æ–∫
- üìä –î–æ–±–∞–≤–ª–µ–Ω—ã –º–µ—Ç—Ä–∏–∫–∏ –≤—Ä–µ–º–µ–Ω–∏ –æ—Ç–≤–µ—Ç–∞
- üí¨ –ü–æ–Ω—è—Ç–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

### 4. **–î–æ–±–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ API** (`pages/index.js`)
- üè• Health check –ø–µ—Ä–µ–¥ –∑–∞–≥—Ä—É–∑–∫–æ–π –¥–∞–Ω–Ω—ã—Ö
- üõ°Ô∏è –ó–∞—â–∏—Ç–∞ –æ—Ç –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö –∑–∞–≥—Ä—É–∑–æ–∫ –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö
- üì± –£–ª—É—á—à–µ–Ω–Ω–∞—è –æ–±—Ä–∞—Ç–Ω–∞—è —Å–≤—è–∑—å –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

### 5. **–°–æ–∑–¥–∞–Ω–∞ —É—Ç–∏–ª–∏—Ç–∞ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏** (`debug-connection.js`)
- üîç –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ API
- üì° –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –≤–æ–∑–º–æ–∂–Ω—ã—Ö –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π
- üí° –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ —É—Å—Ç—Ä–∞–Ω–µ–Ω–∏—é –ø—Ä–æ–±–ª–µ–º

## üöÄ –ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å

### –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
```bash
node debug-connection.js
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ API –≤—Ä—É—á–Ω—É—é
```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ health endpoint (–Ω–æ–≤—ã–π –¥–æ–º–µ–Ω —Å SSL)
curl https://malabar-event.ru:3001/api/health

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏–≥—Ä–æ–∫–æ–≤ (–Ω–æ–≤—ã–π –¥–æ–º–µ–Ω —Å SSL)
curl https://malabar-event.ru:3001/api/players

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —á–µ—Ä–µ–∑ IP (fallback)
curl http://46.173.17.229:3001/api/health
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–æ—Ü–µ—Å—Å–æ–≤
```bash
# –ö–∞–∫–∏–µ –ø—Ä–æ—Ü–µ—Å—Å—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç –ø–æ—Ä—Ç 3001
lsof -i :3001

# –°—Ç–∞—Ç—É—Å —Å–µ—Ä–≤–µ—Ä–∞ (–µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è systemd)
systemctl status malabar-server
```

## üîß –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã –æ—à–∏–±–æ–∫

1. **–°–µ—Ä–≤–µ—Ä –Ω–µ –∑–∞–ø—É—â–µ–Ω**
   - –ó–∞–ø—É—Å—Ç–∏—Ç–µ: `node server/server.js`
   - –ò–ª–∏ —á–µ—Ä–µ–∑ PM2: `pm2 start ecosystem.config.js`

2. **–ü–æ—Ä—Ç –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω —Ñ–∞–π—Ä–≤–æ–ª–æ–º**
   - –û—Ç–∫—Ä–æ–π—Ç–µ –ø–æ—Ä—Ç 3001: `ufw allow 3001`

3. **–ö–æ–Ω—Ñ–ª–∏–∫—Ç –ø–æ—Ä—Ç–æ–≤**
   - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ: `netstat -tulnp | grep 3001`

4. **–ü—Ä–æ–±–ª–µ–º—ã —Å CORS**
   - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–æ–º–µ–Ω –≤ –±—Ä–∞—É–∑–µ—Ä–µ
   - –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –¥–æ–º–µ–Ω –¥–æ–±–∞–≤–ª–µ–Ω –≤ CORS —Å–ø–∏—Å–æ–∫

## üìä –ß—Ç–æ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å

### –†–∞–Ω—å—à–µ:
```javascript
// –ü—Ä–æ—Å—Ç–∞—è –ª–æ–≥–∏–∫–∞ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è URL
const API_BASE_URL = 'http://localhost:3001';
```

### –¢–µ–ø–µ—Ä—å:
```javascript
// –£–º–Ω–∞—è –ª–æ–≥–∏–∫–∞ —Å fallback –∏ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–æ–π
const getApiBaseUrl = () => {
  if (typeof window !== 'undefined') {
    const host = window.location.hostname;
    console.log('üîß API Config - –æ–ø—Ä–µ–¥–µ–ª—è–µ–º URL –¥–ª—è —Ö–æ—Å—Ç–∞:', host);
    
    // –†–µ–¥–∏—Ä–µ–∫—Ç —Å www –Ω–∞ –±–µ–∑ www
    if (host.startsWith('www.malabar-event.ru')) {
      window.location.replace('https://malabar-event.ru' + window.location.pathname);
      return;
    }
    
    if (host === 'malabar-event.ru') {
      return 'https://malabar-event.ru:3001';
    }
    // ... –¥—Ä—É–≥–∏–µ –ø—Ä–æ–≤–µ—Ä–∫–∏
  }
  return 'https://malabar-event.ru:3001'; // –ù–∞–¥–µ–∂–Ω—ã–π fallback —Å SSL
};
```

## ‚ú® –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è

- üìà –ú–µ—Ç—Ä–∏–∫–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ API
- üîÑ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π retry –ø—Ä–∏ —Å–µ—Ç–µ–≤—ã—Ö –æ—à–∏–±–∫–∞—Ö
- üì± –õ—É—á—à–µ UX –ø—Ä–∏ –ø—Ä–æ–±–ª–µ–º–∞—Ö —Å —Å–µ—Ç—å—é
- üõ†Ô∏è –ü–æ–¥—Ä–æ–±–Ω–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤

## üéØ –†–µ–∑—É–ª—å—Ç–∞—Ç

–¢–µ–ø–µ—Ä—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ:
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π API URL
- ‚úÖ –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –ø–æ–Ω—è—Ç–Ω—ã–µ –æ—à–∏–±–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
- ‚úÖ –ò–º–µ–µ—Ç –≤—Å—Ç—Ä–æ–µ–Ω–Ω—É—é –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫—É —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
- ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç —Å—Ç–∞–±–∏–ª—å–Ω–æ –Ω–∞ VPS —Å–µ—Ä–≤–µ—Ä–µ
- ‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —Ä–∞–∑–ª–∏—á–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è (localhost, VPS IP, –¥–æ–º–µ–Ω)

---

**–°–æ–∑–¥–∞–Ω–æ:** 16 —Å–µ–Ω—Ç—è–±—Ä—è 2025
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ –∏ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–æ
